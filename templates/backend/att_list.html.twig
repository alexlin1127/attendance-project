{% extends '/backend/dashboard.html.twig' %}
{% block content %}
<h3>學員資料</h3>
<div class="d-flex gap-3 mb-3">
<a href="att_list.php?mode=add" class="btn btn-info">新增數據</a>
<a href="att_list.php?mode=add" class="btn btn-info">建立使用者</a>
{# <select>
    <option value="0">學員姓名</option>
    {% for item in students %}
        <option name = 'name' value="{{item.id}}">{{item.name}}</option>
    {% endfor %}
    </select> #}
</div>
<div class="row">
    <div class="col-12 col-sm-12 col-md-12">
        <div class="card">
            <div class="card-body">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>名字</th>
                            <th>日期</th>
                            <th>出席時數</th>
                            <th>早退時數</th>
                            <th>缺席時數</th>
                            <th>功能</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for item in results %}
                        <tr>
                            <td>{{item.name}}</td>
                            <td>{{item.class_date}} </td>
                            <td>{{item.attended_hours}}</td>
                            <td>{{item.leave_early_hours}}</td>
                            <td>{{item.absent_hours}}</td>
                            <td>
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <a href="#" class="btn btn-sm btn-primary">查看</a>
                                <a href="#" class="btn btn-sm btn-warning">編輯</a>
                                <a href="#" class="btn btn-sm btn-danger">刪除</a>
                                
                            </div>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <nav aria-label="Page navigation example">
                    <ul class="pagination">
                        <li class="page-item"><a class="page-link" href="att_list.php?page={{prevpage}}">上一頁</a></li>
                        
                        <li class="page-item"><a class="page-link" href="att_list.php?page={{nextpage}}">下一頁</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}

<script>
// 加入購物車
const add2cartBtns = document.querySelectorAll(".add2cart");
add2cartBtns.forEach(button => {
    button.addEventListener('click', function(e) {
    e.preventDefault();
    const pid = this.getAttribute('data-pid');
    //console.log(pid);
    fetch(`bk-product.php?mode=add2cart&pid=${pid}&quan=1`, {
        method: 'POST',
        header: {
            'Content-Type':'application/json'
        },
        body:JSON.stringify({"pid": pid})
    })
    .then(response=>response.json()).
    then(data=>{
        console.log(data);
        updateCartView();//放入購物車時,觸發更新
    })
    })
})

function updateCartView(){
    fetch(`bk-product.php?mode=apiGetCart`).
        then(response=>{
            return response.text();
        })
        .then(html =>{
            console.log(html);
            document.getElementById('nav-cart-div-tbl').innerHTML = html;
        })
}
function removeItem(pid){
    console.log(pid);
    fetch(`bk-product.php?mode=removeitem&pid=${pid}`);
    updateCartView();
}
updateCartView();

</script>
{% endblock %}